<%= render 'shared/static_header' %>
<section class="slide accept-slide">
  <div class="row moving_proposals_accept">
    <div class='col-md-4'></div>
    <div class='col-md-4'>
      <div class="proposal_accept">
        <p>
          <div class='prop-acpt-go-back-btn'>Go Back</div>
        </p>
        <p>
          <span>
            Moving Company:
          </span>
          <span class="acpt-label acpt-company"></span>
        </p>
        <p>
          <span>Moving From:</span>
          <span class="acpt-label acpt-company-from"></span>
        </p>
        <p>
          <span>Moving To</span>
          <span class="acpt-label acpt-company-to"></span>
        </p>
        <p>
          <span>Moving Date:</span>
          <span class="acpt-label acpt-company-date"></span>
        </p>
      </div>
    </div>
    <div class='col-md-4'></div>
  </div>
  <div class="row apply-promocode">
    <div class="col-md-4">
    </div>
    <div class="col-md-4">
      <div class="col-md-8 pull-left acpt-form">
        <input type="texgt" name="promo-code" class="promo-code form-control" placeholder="Promo Code">
      </div>
      <div class="col-md-4 pull-right acpt-apply">
        <div class="text-center promo-apply-btn">Apply</div>
      </div>
    </div>
    <div class="col-md-4">
    </div>
  </div>
  <div class="row estimate-cost">
    <div class="col-md-4">
    </div>
    <div class="col-md-4">
      <div class="text-center estimated_cost_text">Estimated Cost: $<span class="acpt-price">300.00</span></div>
      <div class="hidden-promocode"></div>
    </div>
    <div class="col-md-4">
    </div>
  </div>
  <div class="row final-amount">
    <div class="col-md-4">
    </div>
    <div class="col-md-4">
      <div class="text-center">Final Cost: $<span class="final-price"></span></div>
    </div>
    <div class="col-md-4">
    </div>
  </div>
  <div class="row card-details">
    <div class="col-md-4">
    </div>
    <div class="col-md-4">
      <div class="col-md-8 pull-left acpt-form payment-message">
        No Payment method available.
      </div>
      <div class="col-md-4 acpt-apply pull-right">
        <a href="/payment-methods" class="add_card_details">Add card</a>
      </div>
    </div>
    <div class="col-md-4">
    </div>
  </div>
  <div class="row approve-details">
    <div class="col-md-4">
    </div>
    <div class="col-md-4">
      <div class="text-center approve-btn">Approve Payment</div>
    </div>
    <div class="col-md-4">
    </div>
  </div>
</section>

<div id="promo-code-popup" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-sm mt-50 page_valid_align new_page_valid_align">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body" align="center">
        <div class="popup_image">
          <img src="/assets/popup_logo.png">
        </div>
        <div class="popup_content">
          <h4 class="modal-title pc-head"></h4>
          <div class="promocode-body">
          </div>
          <button class="new-popup-btn" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="card-page-error" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-sm mt-50 page_valid_align new_page_valid_align">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body" align="center">
        <div class="popup_image">
          <img src="/assets/popup_logo.png">
        </div>
        <div class="popup_content">
          <h4 class="modal-title pc-head"></h4>
          <div class="card-page-error-body">
          </div>
          <button class="new-popup-btn" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>

  </div>
</div>

<%= render 'add_new_card' %>

<script type="text/javascript">
  $(document).ready(function(){
    acceptCompany();
    var API_URL = "http://45.56.72.52/api/userapi/";
    var current_user = localStorage.getItem('user_id');
    var card_params = '{"user_id":"'+current_user+'"}'
    var card_id = localStorage.getItem("card_id")
    var card_number = localStorage.getItem("card_number")
    var final_price = localStorage.getItem("final_price");
    if (current_user != "" && current_user != null && current_user != undefined) {
      $.ajax({
        url: API_URL+"getUserCards",
        type: 'POST',
        data: card_params,
      })
      .done(function(data) {
        if (card_id != "" && card_id != null && card_id != undefined) {
          $('.add_card_details').text("Change Card");
          $(".payment-message").text("XXXX XXXX XXXX "+card_number+"")
        }else{
          $('.add_card_details').text("Add Card");
          $(".payment-message").text("Card Available")
        }
      });
    }
    if (final_price != "" && final_price != null && final_price != undefined) {
      $('.final-amount').css("display", "block");
      $(".final-price").text(final_price);
      $(".promo-apply-btn").css("pointer-events", "none");
      $(".promo-apply-btn").css("background-color", "rgba(200, 208, 208, 0.87)");
      $(".promo-code").val("");
    }
  });
</script>